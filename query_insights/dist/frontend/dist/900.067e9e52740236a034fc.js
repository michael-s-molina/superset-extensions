"use strict";(self.webpackChunkquery_insights=self.webpackChunkquery_insights||[]).push([[900],{160:function(e,t,a){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},r.apply(this,arguments)},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=n(a(852)),i=a(425),o=a(111),u=n(a(653)),d="#e0e0e0",c="#f7f7f7",s="#666",f={padding:"4px 8px",borderColor:d,borderWidth:1,borderStyle:"solid"},p={textAlign:"center"},m={maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",lineHeight:"1.3"},y=function(){return l.default.createElement("span",{style:{display:"block",textAlign:"center"}},"-")},h=function(e){var t=e.table;return l.default.createElement("span",{style:{color:"#1890ff",fontWeight:"bold"}},t)},v=function(e){var t=e.description;return l.default.createElement("td",{style:f},t?l.default.createElement(i.Tooltip,{title:t},l.default.createElement("div",{style:m},t)):l.default.createElement(y,null))},b=function(e){var t=e.members;return l.default.createElement("div",null,t.slice(0,3).map(function(e,t){return l.default.createElement(i.Tooltip,{title:e.name||"Unknown member",key:t},l.default.createElement(i.Avatar,{src:e.profilePictureUrl,alt:e.name||"Unknown member",size:"small",style:{marginRight:2,borderColor:"#d9d9d9"}},(a=e.name)?a.split(" ").map(function(e){return e[0].toUpperCase()}).join(""):"?"));var a}),t.length>3&&l.default.createElement(i.Avatar,{size:"small",style:{backgroundColor:"#f0f0f0",color:s}},"+",t.length-3))},E=function(e){var t=e.ownerTeam;return l.default.createElement("td",{style:f},t?l.default.createElement("div",null,l.default.createElement("div",{style:{fontWeight:"bold",marginBottom:"4px"}},t.name),t.slackChannel&&l.default.createElement("div",{style:{marginBottom:"8px"}},l.default.createElement(o.SlackOutlined,{style:{marginRight:"4px"}}),l.default.createElement("span",{style:{fontSize:"11px",color:s}},"#",t.slackChannel)),t.members&&t.members.length>0&&l.default.createElement(b,{members:t.members})):l.default.createElement(y,null))},g=function(e){var t,a=e.dqScore;return l.default.createElement("td",{style:f},l.default.createElement("div",{style:p},null!=(null==a?void 0:a.dataQualityScore)?l.default.createElement(l.default.Fragment,null,l.default.createElement("div",{style:{fontSize:"14px",fontWeight:"bold",color:(t=a.dataQualityScore,t>=80?"#52c41a":t>=65?"#1890ff":t>=45?"#faad14":"#ff4d4f")}},a.dataQualityScore),l.default.createElement("div",{style:{fontSize:"10px",color:s}},"Quality Score")):l.default.createElement(y,null)))},_=function(e){var t=e.isCertified;return l.default.createElement("td",{style:f},l.default.createElement("div",{style:p},t?l.default.createElement(i.Tooltip,{title:"Midas Certified"},l.default.createElement(u.default,{size:24})):l.default.createElement(y,null)))},S=function(e){var t=e.retentionDays;if(null==t)return l.default.createElement("td",{style:f},l.default.createElement("div",{style:p},l.default.createElement(y,null)));var a=function(e){if(e<=99)return{value:String(e),unit:1===e?"day":"days"};if(e<365){var t=e/30,a=Math.round(10*t)/10;return{value:a%1==0?String(Math.round(a)):a.toFixed(1),unit:1===a?"month":"months"}}var r=e/365,n=Math.round(10*r)/10;return{value:n%1==0?String(Math.round(n)):n.toFixed(1),unit:1===n?"year":"years"}}(t),r=a.value,n=a.unit,o=l.default.createElement("div",{style:{fontSize:"12px"}},r," ",n);return l.default.createElement("td",{style:f},l.default.createElement("div",{style:p},t>99?l.default.createElement(i.Tooltip,{title:"".concat(t," days")},l.default.createElement("div",{style:{cursor:"help"}},o)):o))},C=function(e){var t=e.latestPartition,a=function(e,t){if(!e)return null;var a=function(e){return{daily:"D",month_end:"ME",month_start:"MS",quarter_end:"QE",quarter_start:"QS",week_start_sun:"W",year_end:"YE",year_start:"YS"}[e]||e.toUpperCase()}(e),r=function(e){return{daily:"Daily partitions",month_end:"End of month partitions",month_start:"Start of month partitions",quarter_end:"End of quarter partitions",quarter_start:"Start of quarter partitions",week_start_sun:"Weekly partitions starting on Sunday",year_end:"End of year partitions",year_start:"Start of year partitions"}[e]||e}(e);return t&&t>0?{label:"".concat(a,"+").concat(t),tooltip:"".concat(r," with output delay of ").concat(t," ").concat(1===t?"day":"days")}:{label:a,tooltip:r}}(e.partitionScheme,e.outputDelay);return l.default.createElement("td",{style:f},l.default.createElement("div",{style:p},t?l.default.createElement("div",{style:{fontSize:"12px",whiteSpace:"nowrap"}},a&&l.default.createElement(i.Tooltip,{title:a.tooltip},l.default.createElement(i.Tag,{color:"default",style:{marginRight:"8px",cursor:"help"}},a.label)),t):l.default.createElement(y,null)))},w=function(e){var t=e.exampleQueries;return l.default.createElement("td",{style:f},l.default.createElement("div",{style:p},t&&t.length>0?l.default.createElement(i.Tooltip,{title:l.default.createElement("div",{style:{maxHeight:"300px",overflow:"auto",maxWidth:"600px"}},t.map(function(e,a){return l.default.createElement("div",{key:a,style:{marginBottom:a<t.length-1?"16px":"0"}},l.default.createElement("div",{style:{fontWeight:"bold",marginBottom:"4px"}},"Query ",a+1,":"),l.default.createElement("pre",{style:{whiteSpace:"pre-wrap",fontSize:"11px",backgroundColor:"#f5f5f5",color:"#333",padding:"8px",borderRadius:"4px",margin:0}},e))})),placement:"left",overlayStyle:{maxWidth:"600px"}},l.default.createElement(o.CodeOutlined,{style:{fontSize:"16px",color:"#1890ff",cursor:"pointer"}})):l.default.createElement(y,null)))};t.default=function(e){var t=e.metadata;return l.default.createElement("table",{style:{width:"100%",borderWidth:1,borderStyle:"solid",borderColor:d,fontSize:"12px"}},l.default.createElement("thead",null,l.default.createElement("tr",null,l.default.createElement("th",{style:r(r({},f),{background:c})},"Table"),l.default.createElement("th",{style:r(r({},f),{background:c})},"Description"),l.default.createElement("th",{style:r(r({},f),{background:c})},"DQ Score"),l.default.createElement("th",{style:r(r({},f),{background:c})},"Midas Certified"),l.default.createElement("th",{style:r(r({},f),{background:c})},"Latest Partition"),l.default.createElement("th",{style:r(r({},f),{background:c})},"Retention"),l.default.createElement("th",{style:r(r({},f),{background:c})},"Owner Team"),l.default.createElement("th",{style:r(r({},f),{background:c})},"Example Queries"))),l.default.createElement("tbody",null,(null==t?void 0:t.length)>0?t.map(function(e,t){return l.default.createElement("tr",{key:t},l.default.createElement("td",{style:f},l.default.createElement(h,{table:e.name})),l.default.createElement(v,{description:e.description}),l.default.createElement(g,{dqScore:e.dqScore}),l.default.createElement(_,{isCertified:e.isMidasCertified}),l.default.createElement(C,{latestPartition:e.latestPartition,partitionScheme:e.partitionScheme,outputDelay:e.outputDelay}),l.default.createElement(S,{retentionDays:e.retentionDays}),l.default.createElement(E,{ownerTeam:e.ownerTeam}),l.default.createElement(w,{exampleQueries:e.exampleQueries}))}):l.default.createElement("tr",null,l.default.createElement("td",{colSpan:8,style:f},"No data available"))))}},653:function(e,t,a){var r,n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},n.apply(this,arguments)},l=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,r,n)}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=r(e),n=0;n<a.length;n++)"default"!==a[n]&&l(t,e,a[n]);return i(t,e),t}),u=this&&this.__rest||function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(a[r[n]]=e[r[n]])}return a};Object.defineProperty(t,"__esModule",{value:!0});var d=o(a(852)),c=0;t.default=function(e){var t=e.size,a=void 0===t?24:t,r=u(e,["size"]),l=(0,d.useRef)("midas-icon-".concat(Date.now(),"-").concat(++c)).current;return d.default.createElement("svg",n({viewBox:"0 0 200 200",fill:"none",width:a,height:a},r),d.default.createElement("rect",{width:"200",height:"200",rx:"40",fill:"url(#".concat(l,")")}),d.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M60.1562 72.4688C60.1562 66 65.4062 60.75 71.875 60.75C78.3438 60.75 83.5938 66 83.5938 72.4688C83.5938 74.1925 83.221 75.8297 82.5517 77.3041L100 93.5892L117.448 77.3041C116.779 75.8297 116.406 74.1925 116.406 72.4688C116.406 66 121.656 60.75 128.125 60.75C134.594 60.75 139.844 66 139.844 72.4688C139.844 77.6262 136.506 82.009 131.875 83.5739V106.364C136.506 107.929 139.844 112.311 139.844 117.469C139.844 123.937 134.594 129.188 128.125 129.188C121.656 129.188 116.406 123.937 116.406 117.469C116.406 112.311 119.744 107.929 124.375 106.364V83.5739C123.747 83.3615 123.142 83.0974 122.566 82.7864L102.559 101.46H97.4413L77.4336 82.7864C76.858 83.0974 76.2534 83.3615 75.625 83.5739V106.364C80.2565 107.929 83.5938 112.311 83.5938 117.469C83.5938 123.937 78.3438 129.188 71.875 129.188C65.4062 129.188 60.1562 123.937 60.1562 117.469C60.1562 112.311 63.4935 107.929 68.125 106.364V83.5739C63.4935 82.009 60.1562 77.6262 60.1562 72.4688ZM76.0938 72.4688C76.0938 70.125 74.2188 68.25 71.875 68.25C69.5312 68.25 67.6562 70.125 67.6562 72.4688C67.6562 74.8125 69.5312 76.6875 71.875 76.6875C74.2188 76.6875 76.0938 74.8125 76.0938 72.4688ZM128.125 113.25C130.469 113.25 132.344 115.125 132.344 117.469C132.344 119.812 130.469 121.688 128.125 121.688C125.781 121.688 123.906 119.812 123.906 117.469C123.906 115.125 125.781 113.25 128.125 113.25ZM76.0938 117.469C76.0938 115.125 74.2188 113.25 71.875 113.25C69.5312 113.25 67.6562 115.125 67.6562 117.469C67.6562 119.812 69.5312 121.688 71.875 121.688C74.2188 121.688 76.0938 119.812 76.0938 117.469ZM132.344 72.4688C132.344 70.125 130.469 68.25 128.125 68.25C125.781 68.25 123.906 70.125 123.906 72.4688C123.906 74.8125 125.781 76.6875 128.125 76.6875C130.469 76.6875 132.344 74.8125 132.344 72.4688Z",fill:"white"}),d.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M160 42H40V138.068L100 168.068L160 138.068V42ZM47.5 133.432V49.5H152.5V133.432L100 159.682L47.5 133.432Z",fill:"white"}),d.default.createElement("defs",null,d.default.createElement("linearGradient",{id:l,x1:"0",y1:"0",x2:"192.415",y2:"158.32",gradientUnits:"userSpaceOnUse"},d.default.createElement("stop",{stopColor:"#EDD55D"}),d.default.createElement("stop",{offset:"1",stopColor:"#A07A44"}))))}},749:function(e,t,a){var r,n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},n.apply(this,arguments)},l=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,r,n)}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=r(e),n=0;n<a.length;n++)"default"!==a[n]&&l(t,e,a[n]);return i(t,e),t}),u=this&&this.__awaiter||function(e,t,a,r){return new(a||(a=Promise))(function(n,l){function i(e){try{u(r.next(e))}catch(e){l(e)}}function o(e){try{u(r.throw(e))}catch(e){l(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(i,o)}u((r=r.apply(e,t||[])).next())})},d=this&&this.__generator||function(e,t){var a,r,n,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=o(0),i.throw=o(1),i.return=o(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(u){return function(o){if(a)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(l=0)),l;)try{if(a=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!((n=(n=l.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){l=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){l.label=o[1];break}if(6===o[0]&&l.label<n[1]){l.label=n[1],n=o;break}if(n&&l.label<n[2]){l.label=n[2],l.ops.push(o);break}n[2]&&l.ops.pop(),l.trys.pop();continue}o=t.call(e,l)}catch(e){o=[6,e],r=0}finally{a=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(a(852)),f=a(425),p=a(919),m=c(a(160)),y=[1],h=function(e,t){switch(t.type){case"QUERY_START":return n(n({},e),{metadata:[],errorState:null,loading:!0});case"QUERY_SUCCESS":return n(n({},e),{metadata:t.payload,errorState:null,loading:!1});case"QUERY_FAIL":return n(n({},e),{metadata:[],errorState:t.payload,loading:!1});case"DATABASE_CHANGED":return{metadata:[],errorState:null,loading:!1,databaseId:t.payload};default:return e}},v={metadata:[],errorState:null,loading:!1,databaseId:null};t.default=function(){var e=(0,s.useReducer)(h,v),t=e[0],a=e[1];return(0,s.useEffect)(function(){var e,t=p.sqlLab.getCurrentTab();(null===(e=null==t?void 0:t.editor)||void 0===e?void 0:e.databaseId)&&a({type:"DATABASE_CHANGED",payload:t.editor.databaseId});var r=p.sqlLab.onDidQueryRun(function(e){var t=e.tab.editor;y.includes(t.databaseId)&&a({type:"QUERY_START"})}),n=p.sqlLab.onDidQuerySuccess(function(e){return u(void 0,void 0,void 0,function(){var t,r,n,l;return d(this,function(i){switch(i.label){case 0:if(t=e.tab.editor,!y.includes(t.databaseId))return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,(o=t.content,t.databaseId,c=t.schema,u(void 0,void 0,void 0,function(){var e,t,a,r,n,l;return d(this,function(i){switch(i.label){case 0:return[4,p.authentication.getCSRFToken()];case 1:return e=i.sent(),[4,fetch("/extensions/query_insights/metadata",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e},body:JSON.stringify({sql:o,default_schema:c})})];case 2:if((t=i.sent()).ok)return[3,7];a="Server returned ".concat(t.status,": ").concat(t.statusText),i.label=3;case 3:return i.trys.push([3,5,,6]),[4,t.json()];case 4:return(r=i.sent()).message&&(a=function(e){var t=e.match(/Query insight service error: ({.*})/);if(t)try{var a=JSON.parse(t[1]);if(a.detail)return a.detail.replace(/\\n/g,"\n")}catch(e){}return e}(r.message)),[3,6];case 5:return i.sent(),[3,6];case 6:throw new Error(a);case 7:return[4,t.json()];case 8:return n=i.sent(),[2,(null===(l=n.result)||void 0===l?void 0:l.tables)||[]]}})}))];case 2:return r=i.sent(),a({type:"QUERY_SUCCESS",payload:r}),[3,4];case 3:return n=i.sent(),l=n instanceof Error?n.message:"An unexpected error occurred while fetching query insights",a({type:"QUERY_FAIL",payload:l}),[3,4];case 4:return[2]}var o,c})})}),l=p.sqlLab.onDidQueryFail(function(e){var t=e.tab.editor;y.includes(t.databaseId)&&a({type:"QUERY_FAIL",payload:"Query insights cannot be generated because the query failed"})}),i=p.sqlLab.onDidChangeEditorDatabase(function(e){a({type:"DATABASE_CHANGED",payload:e})});return function(){r.dispose(),n.dispose(),l.dispose(),i.dispose()}},[]),null!==t.databaseId&&y.includes(t.databaseId)?t.errorState?s.default.createElement(f.Alert,{message:s.default.createElement("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordBreak:"break-word"}},t.errorState),type:"error"}):t.loading?s.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"}},s.default.createElement(f.Spin,{size:"default"}),s.default.createElement("div",{style:{marginLeft:"8px",color:"#666",fontSize:"14px"}},"Loading...")):s.default.createElement(m.default,{metadata:t.metadata}):s.default.createElement(f.Alert,{message:"Query insights are not available for this database"})}},900:function(e,t,a){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deactivate=t.activate=void 0;var n=r(a(852)),l=a(919),i=r(a(749));t.activate=function(e){e.disposables.push(l.core.registerViewProvider("query_insights.main",function(){return n.default.createElement(i.default,null)}))},t.deactivate=function(){}}}]);